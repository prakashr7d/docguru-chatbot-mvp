version: "2.0"
rules:

- rule: respond to chitchat
  steps:
  - intent: chitchat
  - action: utter_chitchat

- rule: anything else deny
  steps:
  - action: utter_anything_else
  - intent: deny
  - action: utter_i_am_here_for_you

- rule: out of scope
  steps:
  - or:
    - intent: nlu_fallback
    - intent: out_of_scope
  - action: utter_default

- rule: Activate login form
  condition:
  - slot_was_set:
    - is_logged_in: false
  - slot_was_set:
    - login_blocked: false
  steps:
  - intent: login
  - action: action_deactivate_loop
  - active_loop: null
  - action: login_form
  - active_loop: login_form

- rule: Submit, deactivate login form
  condition:
  - active_loop: login_form
  steps:
  - action: login_form
  - active_loop: null
  - action: action_login_form

- rule: login unblocked event
  condition:
  - slot_was_set:
    - login_blocked: true
  steps:
  - intent: EXTERNAL_unblock_login
  - action: action_unblock_login

- rule: logout user
  steps:
  - intent: EXTERNAL_logout
  - action: action_logout

- rule: login blocked
  condition:
  - slot_was_set:
    - login_blocked: true
  steps:
  - intent: login
  - action: action_login_form

- rule: already login
  condition:
  - slot_was_set:
    - is_logged_in: true
  steps:
  - intent: login
  - action: utter_already_logged_in

- rule: order status + login blocked
  condition:
  - slot_was_set:
    - login_blocked: true
  - active_loop: null
  steps:
  - intent: check_all_orders
  - action: utter_check_all_orders_for_blocked_user
  - action: action_login_form

- rule: order status + valid login
  condition:
  - slot_was_set:
    - is_logged_in: true
  - active_loop: null
  steps:
  - intent: check_all_orders
  - action: action_check_all_orders

- rule: logout
  steps:
  - intent: logout
  - action: action_logout
  - action: utter_logout

- rule: show more
  steps:
  - intent: show_more
  - action: show_more_action

- rule: return order, show valid return orders, login
  condition:
  - slot_was_set:
    - is_logged_in: true
  steps:
  - intent: return_order
  - active_loop: null
  - action: action_show_valid_return_order

- rule: return order, show valid return orders, not login
  condition:
  - slot_was_set:
    - is_logged_in: false
  steps:
  - intent: return_order
  - action: utter_not_logged_in_prompt
  - action: login_form
  - active_loop: login_form

- rule:  return form + valid login
  condition:
  - slot_was_set:
    - is_logged_in: true
  - slot_was_set:
    - login_blocked: false
  - active_loop: null
  steps:
  - intent: select_return_order
  - action: return_order_form
  - active_loop: return_order_form

- rule:  return form + not logged
  condition:
  - slot_was_set:
    - is_logged_in: false
  - active_loop: null
  steps:
  - intent: select_return_order
  - action: utter_not_logged_in_prompt
  - action: login_form
  - active_loop: login_form

- rule: return form + blocked login
  condition:
  - slot_was_set:
    - login_blocked: true
  - active_loop: null
  steps:
  - intent: select_return_order
  - action: utter_check_all_orders_for_blocked_user
  - action: action_login_form
  - action: utter_anything_else

- rule: submit, return form
  condition:
  - active_loop: return_order_form
  - slot_was_set:
    - is_logged_in: true
  steps:
  - action: return_order_form
  - active_loop: null
  - action: action_return_order
  - action: utter_anything_else

- rule: replace order
  steps:
  - intent: replace_order
  - action: utter_replace_order_inprogress
  - action: utter_anything_else_options