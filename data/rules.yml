version: "2.0"
rules:

- rule: respond to chitchat
  steps:
  - intent: chitchat
  - action: utter_chitchat
- rule: out of scope
  steps:
  - or:
    - intent: nlu_fallback
    - intent: out_of_scope
  - action: utter_default

- rule: Activate login form
  condition:
  - slot_was_set:
    - is_logged_in: false
  - slot_was_set:
    - login_blocked: false
  steps:
  - intent: login
  - action: action_deactivate_loop
  - active_loop: null
  - action: login_form
  - active_loop: login_form

- rule: Submit, deactivate login form
  condition:
  - active_loop: login_form
  steps:
  - action: login_form
  - active_loop: null
  - action: action_login_form

- rule: login unblocked event
  condition:
  - slot_was_set:
      - login_blocked: true
  steps:
  - intent: EXTERNAL_unblock_login
  - action: action_unblock_login

- rule: logout user
  steps:
  - intent: EXTERNAL_logout
  - action: action_logout

- rule: login blocked
  condition:
  - slot_was_set:
    - login_blocked: true
  steps:
  - intent: login
  - action: action_login_form

- rule: order status + login blocked
  condition:
  - slot_was_set:
    - login_blocked: true
  steps:
  - intent: order_status
  - action: utter_order_status_for_blocked_user
  - action: action_login_form

- rule: order status + valid login
  condition:
  - slot_was_set:
    - is_logged_in: true
  steps:
  - intent: order_status
  - action: action_order_status

- rule: logout
  steps:
  - intent: logout
  - action: action_logout
  - action: utter_logout

- rule: show more
  steps:
  - intent: show_more
  - action: show_more_action

- rule:  return form + valid login
  condition:
  - slot_was_set:
    - is_logged_in: true
  steps:
  - intent: select_order
  - action: return_order_form
  - active_loop: return_order_form

- rule: return form + blocked login
  condition:
  - slot_was_set:
    - login_blocked: true
  steps:
  - intent: select_order
  - action: utter_order_status_for_blocked_user
  - action: action_login_form

- rule: submit, return form
  active_loop: return_order_form
  steps:
  - action: return_order_form
  - active_loop: null
  - action: action_return_order